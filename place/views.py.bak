from django.shortcuts import render
from .models import PlaceTb, CodeTb
from district.models import DistrictTb
from django.http import JsonResponse
from django.core.paginator import Paginator
import json

# Create your views here.
def category(request):
    district = request.GET.get('district')
    category = request.GET.get('category')

    page = request.GET.get('page', 1)

    print(f"district : {district} , category : {category}, page : {page}")
    try:
        page = int(page)
    except ValueError:
        page = 1  # 만약 페이지 번호가 유효하지 않다면 1페이지로 설정합니다.

    district_id = district if district else '8'
    category = category if category else 'PC04'

    district = DistrictTb.objects.get(district_id = district_id)
    object_list = PlaceTb.objects.filter(district = district_id, place_category_cd = category).values()
    paginator = Paginator(object_list, 12)

    try:
        page_obj = paginator.get_page(page)
    except:
        page_obj = []  # 만약 페이지 번호가 유효하지 않거나 페이지가 비어있다면 빈 리스트를 반환


    if request.headers.get('x-requested-with') == 'XMLHttpRequest':
        return JsonResponse({
            'place_list': list(page_obj.object_list)
        }, safe=False)


    # 테이블 명 바꿔야함
    context = {
        'district' : district,
        'category' : category,
        'place_list' : list(page_obj.object_list),
        "categories" : list(CodeTb.objects.filter(parent_code='PC').values()),
    }
    return render(request, 'place/place.html', context)





def get_spots_by_category(request):
    gu = request.GET.get("gu")
    category = request.GET.get('category')     

    data = []
    # data = shop_tb.object.filter(gu = gu, category = category)
    
    return JsonResponse(data, safe=False)